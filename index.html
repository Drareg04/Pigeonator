<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="deps/farbtastic/farbtastic.css">
    <link rel="stylesheet" href="/deps/filepond/filepond.min.css">
    <link rel="stylesheet" href="/deps/filepond/filepond-plugin-image-preview.min.css">
    <title>Pigeonator</title>
    <link rel="icon" type="image/x-icon" href="img/pigeon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="/deps/jquery-3.7.1.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jcanvas/23.0.0/umd/jcanvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <script src="https://unpkg.com/konva@10/konva.min.js"></script>
    <script src="deps/farbtastic/farbtastic.js"></script>
</head>

<body>
    <div class="content">
        <div class="container">
            <div class="menu">
                <div class="fix" style="display: none;">
                    <span><img src="img/Pigeonimg.png" onclick="changeContent('img')"></span>
                    <span><img src="img/Pigeonfilm.png" onclick="changeContent('vid')"></span>
                    <span><img src="img/Pigeongif.png" onclick="changeContent('gif')"></span>
                    <span><img src="img/Pigeonconverter.png" onclick="changeContent('cnv')"></span>
                </div>
            </div>
            <div class="content" id="content">

                <!-- a header -->
                <div class="header">
                    <img src="img/logoboina.png" id="Vanpigeon"></img>
                    <h1>Pigeonator</h1>
                    <img src="img/img.png" class="indicator">
                </div>

                <!-- upper -->
                <div class="upper">
                    <span onclick="showDiv()"><img src="img/Newproject.png">
                        <p>New Project</p>
                    </span>
                    <span><img src="img/Pcupload.png">
                        <p>Upload from computer</p>
                    </span>

                    <!-- new project -->
                    <div id="dragdiv" style="display: none;">

                    </div>


                </div>

                <!-- lower -->
                <div class="lower">
                    <input type="file" id="Upload" name="filename"
                        accept="image/jpeg, image/png, image/svg+xml, image/webp, image/avif, image/x-icon, image/bmp, image/tiff">
                </div>

            </div>

            <div class="blank">
                <div id="fullslider" class="fix">
                    <div id="slider">
                        <div id="ApiContent">
                            <!-- Add content here :) -->
                        </div>
                         <a href="suggestions/index.php"><img id="pigeonmail" src="img/yougotmail.webp"></a>
                    </div>
                    
                    <div id="lineicon">
                        <img src="img/line.png" id="lineicon1">
                        <img src="img/line.png" id="lineicon2">
                        <img src="img/line.png" id="lineicon3">
                    </div>
                </div>
            </div>

            <div class="footer"></div>

        </div>
    </div>
    <!-- <script src="scripts/defaults.js"></script> -->
    <!-- <script src="scripts/index.js"></script> -->
    <script src="scripts/menu.js"></script>
    <script src="scripts/drag.js"></script>
    <script>
        $('#lineicon').on('click', function () {
            $("#fullslider").toggleClass("animated");


            // Wikimedia Commons API, random pigeon image
            // don't touch
            if (typeof window.responseJson != 'object') {

                // i don't like the MediaWiki api
                var url = "https://commons.wikimedia.org/w/api.php";
                url += "?action=query&generator=images";
                url += "&prop=imageinfo";
                url += "&gimlimit=20";
                url += "&redirects=1&titles=Pigeon";
                url += "&iiprop=timestamp|user|comment|canonicaltitle|url";
                url += '&format=json&callback=processResponse';


                /*
                 * XSS thingamagong
                 */
                var script = document.createElement('script');
                script.src = url;
                document.body.appendChild(script);
                document.body.removeChild(script);

            }
            else if ($("#fullslider").hasClass("animated")) {
                processResponse(window.responseJson);
            }

        });


        // function that gets called upon WikiMedia Commons API response
        function processResponse(json) {
            window.responseJson = json

            // i REALLY don't like the MediaWiki api
            // this is stupid but idc remove 2 bad responses (BluePencil.SVG & BNE logo)
            var random = ""
            while(random == "" || random.canonicaltitle.match(/(?<=:)[^.]*(?=\.)/) == "Blue pencil" || random.canonicaltitle.match(/(?<=:)[^.]*(?=\.)/) == "BNE logo"){
                var pages = json.query.pages;
                var keys = Object.keys(pages);
                random = pages[keys[keys.length * Math.random() << 0]].imageinfo[0];
                console.log(random.canonicaltitle.match(/(?<=:)[^.]*(?=\.)/))
            }

            console.log(random)

            $("#ApiContent").html('\
                <a  href="' + random.descriptionurl + '"><img src="' + random.url + '"/></a>\
                <a>' + random.canonicaltitle.match(/(?<=:)[^.]*(?=\.)/), +'</a>\
                ');
        }


        console.log("loaded index.html JS")
    </script>


</body>

</html>